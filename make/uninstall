#!/bin/sh

#-------------------------------------------------------------------------------
# Copyright 2018-2019 Dominik Salvet
# SPDX-License-Identifier: MIT
# https://gitlab.com/dominiksalvet/gim
#-------------------------------------------------------------------------------
# DESCRIPTION:
#   This file represents a gim uninstallation script.
# PARAMETERS:
#   $1 - gim directory path
#-------------------------------------------------------------------------------

#-------------------------------------------------------------------------------
# shellcheck disable=SC1090,SC2034
#-------------------------------------------------------------------------------


#-------------------------------------------------------------------------------
# INITIALIZATION
#-------------------------------------------------------------------------------

# gim library path is relative to the gim path and it must exist
GIM_LIB_DIR="$(cd -- "$1"/lib/gim/ && pwd)" &&

# load file path abstraction module
. "$GIM_LIB_DIR"/path &&

# load the default RC file
. "$(path_default_rc)" &&

# overwrite default prefix if any delivered
GIM_PREFIX="${PREFIX:-"$GIM_PREFIX"}" &&

# load the configuration editor
. "$1"/make/ced &&

#-------------------------------------------------------------------------------
# UNINSTALLATION
#-------------------------------------------------------------------------------

# remove gim binary
rm -f "${GIM_PREFIX:?}"/bin/gim &&
# remove gim library
rm -r -f "${GIM_PREFIX:?}"/lib/gim/ &&

# remove gim binary directory from PATH
ced_remove_profile gim-bin-path &&
# remove Bash tab completion
ced_remove_bash_completion gim-prompt &&

# if used installer is not gim, delete from gim database must be done here
if [ "$INSTALLER" != gim ]; then
    # overwrite default database directory path if any delivered
    GIM_DB_DIR="${DB_DIR:-"$GIM_DB_DIR"}" &&
    GIM_STATUS_PATH="$GIM_DB_DIR"/status && # derive gim status path
    
    # load gim database interface module
    . "$(path_dbi)" &&

    # delete gim from database
    dbi_init &&
    dbi_delete 'gitlab.com/dominiksalvet/gim'
fi
